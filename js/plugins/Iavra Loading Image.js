(function($,undefined){"use strict";var _params=$plugins.filter(function(p){return p.description.contains("<Iavra Loading>")})[0].parameters;var _param_image=_params["Image"];var _param_background=_params["Background"];var _param_frames=Math.max(1,_params["Frames"]|0);var _param_interval=Math.max(0,_params["Interval"]|0);$._extend||($._extend=function(b,e){for(var k in e){b[k]=e[k]}return b});var _x=_params["X"],_y=_params["Y"],_cx=_x!=(_x|0),_cy=_y!=(_y|0),_w,_h,_t=0,_r=false;var loadBackground=function(src){if(!src){return}Graphics._loadingBack=new Image;Graphics._loadingBack.src=src};var loadImage=function(src){if(!src){return}var img=new Image;img.src=src;img.onload=function(img){_w=img.width/_param_frames,_h=img.height,_r=true}.bind(null,img);img.onerror=function(){throw new Error("Error loading '"+src+"'.")};Graphics._loadingImage=img};var drawBackground=function(context,img){if(img){context.drawImage(img,0,0,Graphics.width,Graphics.height)}};var drawImage=function(context,img){if(img&&_r){var dx=_cx?(Graphics.width-_w)/2:1/_x<0?Graphics.width-_w-_x:_x;var dy=_cy?(Graphics.height-_h)/2:1/_y<0?Graphics.height-_h-_y:_y;var f=_param_interval?_t++/_param_interval%_param_frames|0:0;context.drawImage(img,_w*f,0,_w,_h,dx,dy,_w,_h)}};var alias_graphics_startLoading=Graphics.startLoading;$._extend(Graphics,{startLoading:function(){alias_graphics_startLoading.call(this);_t=0},setLoadingImage:function(){loadBackground(_param_background);loadImage(_param_image)},_paintUpperCanvas:function(){this._clearUpperCanvas();if(this._loadingCount>=20){var context=this._upperCanvas.getContext("2d");context.save();context.globalAlpha=((this._loadingCount-20)/30).clamp(0,1);drawBackground(context,this._loadingBack);drawImage(context,this._loadingImage);context.restore()}}})})(this.IAVRA||(this.IAVRA={}));